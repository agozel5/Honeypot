{% extends "base.html" %}
{% block content %}
<h2>Test baÄŸlantÄ±larÄ± oluÅŸtur</h2>
<form action="{{ url_for('generate') }}" method="post" class="row" style="margin-top:10px;">
  <div>
    <label>Sahte dosya adÄ±</label>
    <input name="file" placeholder="maas_raporu_2025.pdf" required>
  </div>
  <div>
    <label>Kampanya (isteÄŸe baÄŸlÄ±)</label>
    <input name="campaign" placeholder="yaz_promo" >
  </div>
  <div>
    <label>BaÄŸlantÄ± sayÄ±sÄ±</label>
    <input name="count" type="number" min="1" max="50" value="1">
  </div>
  <div style="display:flex; align-items:flex-end;">
    <button type="submit">OluÅŸtur</button>
  </div>
</form>

<h3 style="margin-top:18px;">Son baÄŸlantÄ±lar</h3>
<div class="table-wrap">
<table>
  <thead>
    <tr>
      <th>OluÅŸturulma</th>
      <th>Dosya</th>
      <th>Kampanya</th>
      <th>URL</th>
      <th>QR</th>
      <th>TÄ±klamalar</th>
      <th>Sil</th>
    </tr>
  </thead>
  <tbody>
    {% for l in links %}
      <tr id="row-{{ l.id }}">
        <td>{{ l.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</td>
        <td>{{ l.file_name }}</td>
        <td>{{ l.campaign or "-" }}</td>
        <td><a href="{{ url_for('click', link_id=l.id, _external=True) }}" target="_blank">aÃ§</a></td>
        <td><a href="{{ url_for('qr', link_id=l.id) }}" target="_blank">PNG</a></td>
        <td><span class="badge">{{ l.clicks|length }}</span></td>
        <td>
          <button onclick="deleteLink({{ l.id }})" style="background:none; border:none; color:red; cursor:pointer;">ğŸ—‘ï¸</button>
        </td>
      </tr>
    {% else %}
      <tr><td colspan="7">HenÃ¼z baÄŸlantÄ± yok.</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>

<script>
function deleteLink(linkId) {
  if (!confirm("Bu baÄŸlantÄ±yÄ± silmek istediÄŸinizden emin misiniz?")) return;

  fetch(`/delete_link/${linkId}`, {
    method: "POST",
    headers: { "X-Requested-With": "XMLHttpRequest" }
  })
  .then(res => {
    if (res.ok) {
      document.getElementById(`row-${linkId}`).remove();
    } else {
      alert("Silme iÅŸlemi baÅŸarÄ±sÄ±z oldu.");
    }
  });
}
</script>
{% endblock %}
